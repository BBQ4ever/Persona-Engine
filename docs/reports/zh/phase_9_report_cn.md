# Persona Engine 技术报告 - Phase 9: 流体姿态与 R.W.C 模型 (Fluid Stances)

## 1. 阶段目标
本阶段致力于将人格切换机制从离散的、硬编码的“RPG 职阶切换”升级为连续的“流体姿态 (Fluid Stance)”模型。通过消除预设人格之间的边界，系统能够在一个三维参数空间内平滑地调整其表达“气场”，实现更拟人、更有深度的交互。

## 2. 核心实现项

### 2.1 R.W.C 姿态向量模型
废弃了传统的枚举类型，引入了三维 **姿态向量 (Stance Vector)**：
- **严谨度 (Rigor, R)**：控制逻辑深度、技术准确性及分析策略。
- **温度 (Warmth, W)**：控制情感价位、语言软化程度及协作性。
- **混乱度 (Chaos, C)**：控制幽默密度及随机波动（可预测性 vs. 创造力）。

### 2.2 向量到底层基因的映射 (The Projection)
`ArchetypeManager` 被重构为“姿态投影仪”。它不再是简单的数值覆盖，而是根据 R.W.C 坐标，在每个 DNA 位点的有效范围内进行线性插值计算。
- **动态变异性**：`Chaos` 参数现在直接调制每个位点的 `variability` 系数，使 AI 在高混乱度下显得更“跳跃”或“兴奋”。

### 2.3 意图驱动的自动切换
L0 调度引擎从建议“预设名称”升级为计算“姿态向量”：
- **数学/科学意图**：自动投影至 `Rigor=0.9, Warmth=0.2, Chaos=0.1`。
- **情感/支持意图**：自动投影至 `Rigor=0.3, Warmth=0.9, Chaos=0.4`。
- 确保了状态转换不再是生硬的“换脸”，而是有机的人格重心偏移。

### 2.4 可视化：DNA 拓扑雷达图 (DNA Topology Radar)
为了揭示 R.W.C 模型背后的几何逻辑，我们实现了 **L2 DNA 雷达图**：
- **动态变形 (Morphing)**：雷达图实时展示 DNA 位点的分值。随着 R.W.C 姿态的平滑切换，雷达图的形状会随之“蠕动”变形，可视化展现人格的“灵魂形状”。
- **自适应标签**：优化了标签锚点算法，确保在任何缩放比例下，长文本（如 LOGICAL, EXPLANATION）都能完整显示，不被切边。

![Persona Engine Dashboard v1.0](../../assets/dashboard_v10.png)

### 2.5 结构重构与稳定性优化
- **测试归档**：将所有 `test_*.py` 文件移至独立的 `/tests` 目录，净化了 `src` 根目录。
- **采样算法修正**：修复了 `SeededSampler` 中的随机噪声放大 Bug，确保即使在高影响力下，姿态锚点依然能保持其稳定性。

## 3. 技术洞察：作为流体的人格姿态
通过向量化，我们实现了“人格连续性”。任何两个预设（如“冷酷分析师”与“温和导师”）现在都可以按任意比例混合。可视化系统通过展示这种拓扑结构的不断流动，赋予了 AI 一种独特的、拟生的人格质感。

## 4. 交付物清单
- `src/l2_genome/archetypes.py`: 重构后的 R.W.C 映射逻辑。
- `src/l2_genome/presets/standard_archetypes.json`: 外部化的预设配置文件。
- `src/l0_orchestrator/engine.py`: 升级为基于向量的意图分析。
- `src/app_integration.py`: 提供流体姿态接口 (`set_stance`)。
- `tests/test_phase_9.py`: 验证流体转换的完整性。

## 5. 下阶段预告: Phase 10 - 多会话一致性与持久化
我们将开始实现长期记忆集成，允许 Persona 的情感状态和累积的“演化漂移 (Drift)”通过内核快照跨会话持久化。
